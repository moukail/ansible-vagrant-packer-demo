---
- name: Base system configuration
  hosts: default
  become: true

  tasks:
    - name: Ensure system is up to date
      ansible.builtin.dnf:
        name: "*"
        state: latest
      when: ansible_facts['os_family'] | lower == "redhat"

    - name: Ensure system is up to date
      ansible.builtin.apt:
        update_cache: true
        upgrade: dist
      when: ansible_facts['os_family'] | lower == "debian"

    - name: include openssl role
      ansible.builtin.include_role:
        name: ansible-role-openssl
      vars:
        openssl_version: "3.5.4"

    - name: include openssh role
      ansible.builtin.include_role:
        name: ansible-role-openssh

    - name: virtualbox guest additions setup
      ansible.builtin.include_tasks: virtualbox.yml
      when: ansible_facts['virtualization_type'] == "virtualbox"
